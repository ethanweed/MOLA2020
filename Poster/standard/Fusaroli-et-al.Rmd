---
poster_height: "36in" # height in inches of poster
poster_width: "48in" # width in inches of poster
font_size: "30pt" #please see github.com/brentthorne/posterdown for compatible options.
title: Intact but Atypical Lexical and Syntactic Alignment in Spontaneous Speech of Children with Autism Spectrum Disorder
author:
  - name: Riccardo Fusaroli
    affil: 1
    orcid: '0000-0003-4775-5219'
  - name: Ethan Weed
    affil: 1
    orcid: '0000-0002-3921-9101'
  - name: Deborah Fein
    affil: 2
    orcid: '0000-0002-8478-5938'
  - name: Letitia Naigles
    affil: 2
    orcid: '0000-0003-2168-9700'
affiliation:
  - num: 1
    address: Aarhus University
  - num: 2
    address: University of Connecticut
column_numbers: 3
#logoright_name: https&#58;//raw.githubusercontent.com/brentthorne/posterdown/master/images/betterhexlogo.png
#logoleft_name: https&#58;//raw.githubusercontent.com/brentthorne/posterdown/master/images/betterhexlogo.png

# colors:
  # \#7F6024
  # \#A5B1D8
  # \#8FA2DF
  # \#E6ECF7
  # \#E6ECF7  
  # orange from cosine figure: #47A2F1
  # blue from cosine figure: #FFA35F
  # darkish blue: \#8FA2DF
  # bronze color from painting: \#B7802A
  # corn yellow color from painting: \#EDEEC6
  # very pale blue from painting: \#F0F8FF
  # golden hue from grass in painting: \#D8B743

# body_bgcol: \#8FA2DF

primary_colour: \#B7802A
secondary_colour: \#F0F8FF
accent_colour: \#EDEEC6

title_textcol: \#F0F8FF
title_textsize: "70pt"
affiliation_textsize: "25pt"

sectitle_bgcol: \#8FA2DF
sectitle_textcol: \#F0F8FF
sectitle_bordercol: \#EDEEC6

output: 
  posterdown::posterdown_html:
    self_contained: false

bibliography: MyLibrary.bib
bibliography_spacing: 0 # sets the multiplier for line spacing of bibliography spacing (between 0 and 1)
bibliography_textsize: "tiny"  # size of the bibliography text size (handy for one too many references!)
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r libraries}
pacman::p_load("dplyr", "kableExtra", "tidyverse", "ggpubr")
```


```{r colorbar, echo=FALSE}
# for rendering pdf
#pagedown::chrome_print("/Users/ethan/Documents/GitHub/MOLA2020/Poster/standard/Fusaroli-et-al.Rmd")

# colorbar function copied from: https://stackoverflow.com/questions/49916591/how-to-reverse-only-one-bar-in-one-cell-if-the-value-is-negative-with-kableextra

# probably get rid of this, but leave it in for now, just in case I want to go back to tables with colorbars
cb <- function(x) {
  range <- max(abs(x))
  width <- round(abs(x / range * 50), 2)
  ifelse(
    x > 0,
    paste0(
      '<span style="display: inline-block; border-radius: 2px; ', 
      'padding-right: 2px; background-color: #FFD700; width: ', 
      width, '%; margin-left: 50%; text-align: right;">', x, '</span>'
    ),
    paste0(
      '<span style="display: inline-block; border-radius: 2px; ', 
      'padding-right: 2px; background-color: #F0F8FF; width: ', 
      width, '%; margin-right: 50%; text-align: right; float: right; ">', x, '</span>'
    )
  )
}


# function for making bar-plots out of table data

barcolor1 <- "#8FA2DF"
barcolor2 <- "#D8B743"

t1 <- read.csv("/Users/ethan/Documents/GitHub/MOLA2020/Poster/Table1b.csv")
t2 <- read.csv("/Users/ethan/Documents/GitHub/MOLA2020/Poster/Table2b.csv")
t3 <- read.csv("/Users/ethan/Documents/GitHub/MOLA2020/Poster/Table3b.csv")

t_est <- t3[,c(1,2,5)]
t_lower <- t3[, c(1,3,6)]
t_upper <- t3[, c(1,4,7)]
t_est <- gather(t_est, key = "Type", value = "LogOdds", -Predictors)
t_lower <- gather(t_lower, key = "ci_Lower", value = "Lower", -Predictors)
t_upper <- gather(t_upper, key = "ci_Upper", value = "Upper", -Predictors)

t_est$Lower <- t_lower$Lower
t_est$Upper <- t_upper$Upper

#tx <- merge(x = t_est, y = t_lower, by = "Predictors", all.y = TRUE)
#ty <- merge(x = tx, y = t_upper, by = "Predictors", all.y = TRUE)
#ty$ci_Lower <- NULL
#ty$ci_Upper <- NULL
#ty$Predictors <- fct_rev(ty$Predictors)
#ty$Type <- as.factor(ty$Type)

#Right outer: merge(x = df1, y = df2, by = "IndexColumn", all.y = TRUE)



x <-  ggplot(t_est, aes(Predictors, LogOdds, fill = Type)) +
  geom_col(aes(), position = "dodge") +
  geom_errorbar(aes(ymin = Lower, ymax = Upper), width = .2, position=position_dodge(.9)) +
  coord_flip() +
  #ylim(-0.75, 0.75) +
  scale_fill_manual("Alignment Type", values = c("Lexical" = barcolor1, "Syntactic" = barcolor2)) +
  theme_classic() +
  labs( y = "\U03B2 (Log Odds)",
        x = "")
x
x + geom_errorbar(aes(ymin = Lower, ymax = Upper, group = Type))

bp <- function(t){
  t$Predictors <- factor(t$Predictors, levels = t$Predictors)
  t$Predictors <- fct_rev(t$Predictors)
  #t <- gather(t, key = "Type", value = "LogOdds", -Predictors, -Lex_lower, -Lex_upper, -Syn_lower, -Syn_upper)
    ggplot(t, aes(t$Predictors, LogOdds)) +
    geom_bar(aes(fill = Type), position = "dodge", stat="identity") +
    geom_errorbar(aes(ymin = lower, ymax = upper)) +
    coord_flip() +
    ylim(-0.75, 0.75) +
    scale_fill_manual("Alignment Type", values = c("Lexical" = barcolor1, "Syntactic" = barcolor2)) +
    theme_classic() +
    labs( y = "\U03B2 (Log Odds)",
          x = "")
}


 #   geom_errorbar(aes(ymin=len-sd, ymax=len+sd), width=.2,
  #             position=position_dodge(.9))

```


# What is Conversational Alignment, and How Can We Measure It?

```{r echo=FALSE, fig.cap = "Edmund C. Tarbell, \"Marjorie and Little Edmund\"",  out.width= "80%", fig.align="center"}
knitr::include_graphics("Cosine-similarity-vert-V2.jpg")
```

Conversational Alignment is the re-use of an interlocutorâ€™s words and syntax, and helps establish common ground [@clark1991grounding]. We calculated alignment in turn-by-turn utterances in the conversations of 67 parent-child dyads over 2 years (approx. ages 2-4).

# What Predicts Whether Children Align With Parents' Utterances?  

```{r fig1, fig.cap = "Factors influencing liklihood of child aligning any tokens",message=FALSE, warning = F, out.width='75%'}

bp(t1)

#kable(t1, "html", align = "c", caption = "Alignment Rate: Do Children Align?", booktabs = T)

```

Older children aligned more often, although less so in children with ASD. VS and MEL scores were the best predictors of children producing an utterance with aligned tokens.

# What Does Alignment Actually Look Like?

<br>

```{r echo=FALSE, warning = FALSE, out.width= "70%", fig.align="center"}
transcript <- read.csv("/Users/ethan/Documents/GitHub/MOLA2020/Poster/transcript-example.csv")
transcript$X <- NULL
names(transcript)[names(transcript) == 'Cosine.similarity'] <- 'Cosine Similarity'
kable(transcript, "html", caption = "Lexical Alignment", align = "l", booktabs = T)
```

<br>

```{r echo=FALSE, warning = FALSE, out.width= "70%", fig.align="center"}
transcript_syn <- read.csv("/Users/ethan/Documents/GitHub/MOLA2020/Poster/transcript-example-syntactic.csv")
transcript_syn$X <- NULL
names(transcript_syn)[names(transcript_syn) == 'Cosine.Similarity'] <- 'Cosine Similarity'
kable(transcript_syn, "html", caption = "Syntactic Alignment", align = "l", booktabs = T)
```

<br>

# What Predicts Exact Repetition of Parents' Utterances?

```{r fig2, fig.cap = "Factors influencing liklihood of child aligning all tokens", message=FALSE, warning = F, out.width='75%'}

bp(t3)

```
Older children were less likely to produce an exact repetition of their parent's utterance, although this was less so in children with ASD. High scores on VS predicted exact repetition positively, while high scores on MEL predicted exact repetition negatively.

<br>

# What Predicts the Level of Partial Alignment?

```{r fig3, fig.cap = "Factors influencing amount partial alignment", message=FALSE, warning = F, out.width='75%'}

bp(t2)

```
Older children aligned less, and chldren with ASD produced fewer aligned lexical tokens than TD children.

# Conclusion and Next Steps
Children with ASD do align lexically and syntactically, but show a slightly different pattern than TD children. An important next step will be to take a closer qualitative look at the exchanges between parents and children, to see *what* sort of tokens they align, and under what circumstances. Another important step will be to assess children's alignment measures as a predictor of later language outcomes.

# Technical details
Cosine similiarity (CS) was calculated using the ALIGN Python library [@duran2019align]. We used a Bayesian multilevel zero-and-one-inflated beta regression approach, which models alignment as a distribution with three parameters, accounting for the propensity of children to align at all (CS = 0), exact repetitions (CS = 1), and the number of linguistic forms aligned on average when the children actually align (CS > 0 < 1), as a function of diagnostic group, age (visit), Vineland Socialization, Mullen Expressive Language and Mullen Visual Reception. 


```{r, include=FALSE}
knitr::write_bib(c('knitr','rmarkdown','posterdown','pagedown'), 'packages.bib')
```

# References
